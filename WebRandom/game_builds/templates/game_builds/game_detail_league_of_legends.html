<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>League of Legends: Ð Ð°Ð½Ð´Ð¾Ð¼Ð½Ñ‹Ð¹ Ð±Ð¸Ð»Ð´</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@3.3.0/tsparticles.bundle.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
      background: linear-gradient(to bottom right, #141e30, #243b55);
      color: #c9d1d9;
      font-family: 'Segoe UI', sans-serif;
      transition: background 1s ease-in-out;
    }
    #tsparticles {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    .container {
      padding-top: 40px;
      position: relative;
    }
    .btn-primary {
      background-color: #238636;
      border: none;
    }
    .btn-primary:hover {
      background-color: #2ea043;
    }
    .btn-primary:active {
      transform: scale(0.96);
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .build-box {
      background-color: #161b22;
      border-radius: 20px;
      padding: 40px 30px;
      margin-top: 30px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      transition: all 0.3s ease-in-out;
      max-width: 1100px;
      margin-left: auto;
      margin-right: auto;
    }
    .champion-image img {
      width: 130px;
      height: 130px;
      border-radius: 20px;
      box-shadow: 0 0 25px rgba(0,255,255,0.5);
    }
    .item-image img {
      width: 90px;
      height: 90px;
      border-radius: 15px;
      box-shadow: 0 0 12px rgba(255,255,255,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .item-image img:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
    }
    .item-block {
      text-align: center;
      margin: 0 10px;
      flex: 1 1 auto;
      opacity: 0;
      transform: translateY(10px);
    }
    .fade-in-item {
      animation: fadeItem 0.4s ease forwards;
    }
    @keyframes fadeItem {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      cursor: pointer;
    }
    .dark .build-box { background-color: #161b22; }
    .light {
      background: linear-gradient(to bottom right, #f8f9fa, #dee2e6);
      color: #212529;
    }
    .light .build-box {
      background-color: #ffffff;
      color: #212529;
    }
    .rarity-mythic img { border: 2px solid #d4af37; }
    .rarity-legendary img { border: 2px solid #1e90ff; }
    .rarity-boots img { border: 2px solid #32cd32; }
    .rarity-unique img { border: 2px solid #ff69b4; }
    .rarity-extra img { border: 2px solid #ffa500; }
    .rarity-label {
      font-size: 0.9rem;
      font-weight: 500;
      margin-top: 5px;
      color: #58a6ff;
    }
  </style>
</head>
<body class="dark">
  <div id="tsparticles"></div>
  <button class="btn btn-secondary theme-toggle">ðŸŒ“ Ð¢ÐµÐ¼Ð°</button>
  <audio id="sound" src="/media/sounds/open.mp3" preload="auto"></audio>
  <div class="container text-center">
    <h1 class="mb-4">ðŸŽ® League of Legends: <span class="text-success">Ð Ð°Ð½Ð´Ð¾Ð¼Ð½Ñ‹Ð¹ Ð±Ð¸Ð»Ð´</span></h1>
    <button id="generateBtn" class="btn btn-primary mb-4">ðŸŽ² Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð±Ð¸Ð»Ð´</button>
    <div id="buildResult" class="build-box fade-in" style="display:none">
      <h2 class="mb-3">Ð§ÐµÐ¼Ð¿Ð¸Ð¾Ð½: <span id="heroName"></span></h2>
      <div class="champion-image mb-4">
        <img id="heroImage" src="" alt="champion" onerror="this.onerror=null;this.src='/media/champion_images/default.png';" />
      </div>
      <h3 class="mb-3">ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚Ñ‹:</h3>
      <div id="itemsRow" class="d-flex justify-content-around flex-wrap">
        <!-- Items injected dynamically -->
      </div>
    </div>
  </div>
  <script>
    tsParticles.load("tsparticles", {
      background: { color: { value: "transparent" } },
      fpsLimit: 60,
      particles: {
        color: { value: "#ffffff" },
        links: { enable: true, color: "#ffffff", distance: 100 },
        move: { enable: true, speed: 1 },
        number: { value: 60 },
        opacity: { value: 0.5 },
        size: { value: 2 }
      }
    });

    const generateBtn = document.getElementById('generateBtn');
    const buildBox = document.getElementById('buildResult');
    const audio = document.getElementById('sound');
    const themeToggle = document.querySelector('.theme-toggle');
    const body = document.body;
    const categories = ["Mythic", "Legendary", "Boots", "Unique", "Extra", "Extra"];
    const categoryClasses = ["mythic", "legendary", "boots", "unique", "extra", "extra"];

    themeToggle.onclick = () => {
      body.classList.toggle('light');
      body.classList.toggle('dark');
    };

    generateBtn.addEventListener('click', () => {
      fetch(window.location.pathname.replace(/\/$/, '') + '/generate/')
        .then(res => res.json())
        .then(data => {
          document.getElementById('heroName').textContent = data.champion.name;
          const heroImage = document.getElementById('heroImage');
          heroImage.src = data.champion.image;
          heroImage.onerror = function() {
            this.onerror = null;
            this.src = '/media/champion_images/default.png';
          };

          const row = document.getElementById('itemsRow');
          row.innerHTML = '';

          data.items.forEach((item, index) => {
            const block = document.createElement('div');
            block.className = `item-block rarity-${categoryClasses[index]}`;
            setTimeout(() => {
              block.classList.add('fade-in-item');
            }, index * 200);
            const safeName = item.name.replace(/\s|'|&/g, '');
            block.innerHTML = `
              <div class="item-image">
                <img src="/media/item_images/${safeName}.png" alt="${item.name}" title="${item.name}" onerror="this.onerror=null;this.src='/media/item_images/default.png';" />
              </div>
              <div class="rarity-label">${categories[index]}</div>
              <div>${item.name}</div>
            `;
            row.appendChild(block);
          });

          buildBox.style.display = 'block';
          buildBox.classList.remove('fade-in');
          void buildBox.offsetWidth;
          buildBox.classList.add('fade-in');

          try {
            audio.pause();
            audio.currentTime = 0;
            audio.play();
          } catch(e) {
            console.warn('Audio play blocked or failed', e);
          }
        })
        .catch(err => {
          console.error(err);
          alert('ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸.');
        });
    });
  </script>
</body>
</html>
