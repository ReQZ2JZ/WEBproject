{% extends 'game_builds/base.html' %}

{% block title %}{{ game.name }} - Random Build{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4 text-center text-uppercase text-primary">{{ game.name }}</h1>
    
    <div class="text-center mb-4">
        <button id="generateBtn" class="btn btn-lg btn-primary shadow">Generate Random Build</button>
    </div>

    <div id="buildResult" style="display: none;">
        <!-- Hero Section -->
        <div class="card mb-4 shadow">
            <div class="card-header bg-primary text-white text-center">
                <h3>Hero</h3>
            </div>
            <div class="card-body text-center">
                <img id="heroImage" src="" alt="Hero" class="img-fluid rounded-circle mb-3" style="max-width: 150px;">
                <h4 id="heroName" class="text-primary fw-bold"></h4>
            </div>
        </div>

        <!-- Items Section -->
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-secondary text-white text-center">
                        <h4>Starting Items</h4>
                    </div>
                    <div class="card-body">
                        <ul id="startingItems" class="list-unstyled d-flex flex-wrap justify-content-center"></ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-secondary text-white text-center">
                        <h4>Early Game Items</h4>
                    </div>
                    <div class="card-body">
                        <ul id="earlyItems" class="list-unstyled d-flex flex-wrap justify-content-center"></ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-secondary text-white text-center">
                        <h4>Mid Game Items</h4>
                    </div>
                    <div class="card-body">
                        <ul id="midItems" class="list-unstyled d-flex flex-wrap justify-content-center"></ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-secondary text-white text-center">
                        <h4>Late Game Items</h4>
                    </div>
                    <div class="card-body">
                        <ul id="lateItems" class="list-unstyled d-flex flex-wrap justify-content-center"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border-radius: 10px;
    }

    .card-header {
        font-weight: bold;
        text-transform: uppercase;
    }

    .item-card {
        margin: 5px;
    }

    .btn-primary {
        background-color: #007bff;
        border: none;
        transition: background-color 0.3s ease;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }

    .text-primary {
        color: #007bff !important;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const generateBtn = document.getElementById('generateBtn');
        if (!generateBtn) {
            console.error("Кнопка 'Generate Random Build' не найдена");
            return;
        }
        
        generateBtn.addEventListener('click', function () {
            // Извлекаем slug из URL (предполагается, что URL имеет вид /game/<slug>/...)
            let parts = window.location.pathname.split('/');
            let slug = parts[2]; 
            fetch(`/game/${slug}/generate/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Network response was not ok. Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Выводим данные в консоль для проверки
                    console.log("Сгенерированный билд:", data);
                    // Здесь можно обновлять DOM: например, показать элемент с билдом
                    document.getElementById('buildResult').style.display = 'block';
                    // Обновите разделы страницы в зависимости от структуры данных
                    // Пример для героя:
                    const heroImage = document.getElementById('heroImage');
                    const heroName = document.getElementById('heroName');
                    if(heroImage && heroName) {
                        heroImage.src = data.hero_image_png || data.hero_image;
                        heroName.textContent = data.hero;
                    }
                    // Аналогично обновите элементы для начала, early_game, mid_game и late_game
                })
                .catch(error => {
                    console.error('Ошибка:', error);
                    alert("Ошибка при генерации билда. Проверьте консоль для деталей.");
                });
        });
    });
</script>
{% endblock %}