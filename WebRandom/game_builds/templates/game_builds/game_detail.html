{% extends 'game_builds/base.html' %}

{% block title %}{{ game.name }} - Random Build{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4 text-center text-uppercase text-primary">{{ game.name }}</h1>
    
    <div class="text-center mb-4">
        <button id="generateBtn" class="btn btn-lg btn-primary shadow">Generate Random Build</button>
    </div>

    <div id="buildResult" style="display: none;">
        <!-- Hero Section -->
        <div class="card mb-4 shadow">
            <div class="card-header bg-primary text-white text-center">
                <h3>Hero</h3>
            </div>
            <div class="card-body text-center">
                <img id="heroImage" src="" alt="Hero" class="img-fluid rounded-circle mb-3" style="max-width: 150px;">
                <h4 id="heroName" class="text-primary fw-bold"></h4>
            </div>
        </div>

        <!-- Items Section -->
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-secondary text-white text-center">
                        <h4>Starting Items</h4>
                    </div>
                    <div class="card-body">
                        <ul id="startingItems" class="list-unstyled d-flex flex-wrap justify-content-center"></ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-secondary text-white text-center">
                        <h4>Early Game Items</h4>
                    </div>
                    <div class="card-body">
                        <ul id="earlyItems" class="list-unstyled d-flex flex-wrap justify-content-center"></ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-secondary text-white text-center">
                        <h4>Mid Game Items</h4>
                    </div>
                    <div class="card-body">
                        <ul id="midItems" class="list-unstyled d-flex flex-wrap justify-content-center"></ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-secondary text-white text-center">
                        <h4>Late Game Items</h4>
                    </div>
                    <div class="card-body">
                        <ul id="lateItems" class="list-unstyled d-flex flex-wrap justify-content-center"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border-radius: 10px;
    }

    .card-header {
        font-weight: bold;
        text-transform: uppercase;
    }

    .item-card {
        margin: 5px;
    }

    .btn-primary {
        background-color: #007bff;
        border: none;
        transition: background-color 0.3s ease;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }

    .text-primary {
        color: #007bff !important;
    }
</style>

<script>
    document.getElementById('generateBtn').addEventListener('click', function () {
        const slug = window.location.pathname.split('/')[2]; // Извлекаем slug из URL
        fetch(`/game/${slug}/generate/`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('buildResult').style.display = 'block';

                // Обновляем героя
                const heroImage = document.getElementById('heroImage');
                const heroName = document.getElementById('heroName');
                heroImage.src = data.hero_image_png || data.hero_image;
                heroName.textContent = data.hero;

                // Обновляем Starting Items
                const startingItems = document.getElementById('startingItems');
                startingItems.innerHTML = ''; // Очищаем предыдущие результаты
                data.starting_items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'item-card me-2';
                    li.innerHTML = `
                        <div class="card text-center shadow-sm" style="width: 80px;">
                            <img src="${item.image_png}" alt="${item.name}" class="card-img-top img-fluid" style="max-height: 50px;">
                            <div class="card-body p-1">
                                <small class="card-title">${item.name}</small>
                            </div>
                        </div>
                    `;
                    startingItems.appendChild(li);
                });

                // Аналогично обновляем Early, Mid и Late Game Items
                const updateItems = (items, containerId) => {
                    const container = document.getElementById(containerId);
                    container.innerHTML = '';
                    items.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'item-card me-2';
                        li.innerHTML = `
                            <div class="card text-center shadow-sm" style="width: 80px;">
                                <img src="${item.image_png}" alt="${item.name}" class="card-img-top img-fluid" style="max-height: 50px;">
                                <div class="card-body p-1">
                                    <small class="card-title">${item.name}</small>
                                </div>
                            </div>
                        `;
                        container.appendChild(li);
                    });
                };

                updateItems(data.early_game, 'earlyItems');
                updateItems(data.mid_game, 'midItems');
                updateItems(data.late_game, 'lateItems');
            })
            .catch(error => console.error('Error:', error));
    });
</script>
{% endblock %}